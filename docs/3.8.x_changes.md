# NcatBot 3.8.x 版本更新说明

## 主要更新内容

### 1. 配置系统增强
- 新增 `config.yaml` 配置文件，支持以下配置项：
  - 基本配置（root账号、bot账号、WebSocket和WebUI地址等）
  - 更新检查设置
  - 调试选项
  - 插件加载控制（白名单和黑名单）
- 改进配置管理功能，支持插件白名单和黑名单机制
- 增加配置验证和默认配置加载功能

### 2. CLI命令行界面重构
- 重构 `main.py`，代码更模块化（从270行减少到74行）
- 新增命令模块：
  - `commands.py`: 基础命令注册和执行系统
  - `info_commands.py`: 帮助和版本信息命令
  - `plugin_commands.py`: 插件管理命令
  - `system_commands.py`: 系统管理命令
  - `registry.py`: 命令注册系统
  - `utils.py`: CLI工具函数

### 3. 插件系统增强
- 新增事件过滤器系统 (`filter.py`)：
  - 支持前缀过滤
  - 支持正则表达式过滤
  - 支持自定义过滤
- 改进插件功能注册机制：
  - 增加更多元数据支持
  - 支持功能描述、使用说明、示例等
  - 增加标签和元数据支持
- 新增插件发布脚本：
  - 支持版本管理
  - 自动生成插件索引
  - 支持依赖管理

### 4. 兼容性改进
- 在 `compatible.py` 中添加 `WeakValueDictionary` 支持
- 增加启动事件支持
- 改进插件验证和依赖管理
- 优化内存管理，防止内存泄漏

### 5. 代码质量提升
- 添加更多类型提示
- 增加详细的文档字符串
- 改进错误处理和日志记录
- 引入废弃警告机制
- 优化代码结构和可维护性

## 使用说明

### 配置文件
配置文件 `config.yaml` 包含以下主要部分：
```yaml
# 基本配置
basic:
  root_account: ""  # root账号
  bot_account: ""   # bot账号
  ws_address: ""    # WebSocket地址
  ws_token: ""      # WebSocket令牌
  webui_address: "" # WebUI地址
  webui_token: ""   # WebUI令牌

# 更新检查
update_check:
  check_napcat: true  # 是否检查NapCat更新
  check_ncatbot: true # 是否检查NcatBot更新

# 插件控制
plugin_control:
  whitelist: []  # 插件白名单
  blacklist: []  # 插件黑名单
```

### 插件管理
新增的插件管理命令：
- `install`: 安装插件
- `remove`: 卸载插件
- `list`: 列出已安装的插件
- `update`: 更新插件
- `create`: 创建新插件模板

### 系统命令
新增的系统管理命令：
- `setqq`: 设置QQ号
- `start`: 启动NcatBot
- `update`: 更新NcatBot和NapCat
- `exit`: 退出CLI工具

## 注意事项
1. 插件白名单和黑名单不能同时使用
2. 建议定期更新NcatBot和NapCat以获取最新功能
3. 使用插件前请确保已正确配置相关依赖
